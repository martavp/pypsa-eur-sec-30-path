\documentclass[3p]{elsarticle} % seleccionar: preprint, review, 1p, 3p, 5p



\usepackage{mathtools}
\journal{ }


%to force all images and table in one single section
\usepackage{placeins}
% It is necesary to add \FloatBarrier in the text. 
% After that order, all the floating are shown.

%%%%%%%%%%%%%%%%%%%%%%%
%% Elsevier bibliography styles
%%%%%%%%%%%%%%%%%%%%%%%
%% To change the style, put a % in front of the second line of the current style and
%% remove the % from the second line of the style you would like to use.
%%%%%%%%%%%%%%%%%%%%%%%

%% Numbered
%\bibliographystyle{model1-num-names}

%% Numbered without titles
%\bibliographystyle{model1a-num-names}

%% Harvard
%\bibliographystyle{model2-names.bst}\biboptions{authoryear}

%% Vancouver numbered
%\usepackage{numcompress}\bibliographystyle{model3-num-names}

%% Vancouver name/year
%\usepackage{numcompress}\bibliographystyle{model4-names}\biboptions{authoryear}

%% APA style
%\bibliographystyle{model5-names}\biboptions{authoryear}

%% AMA style
%\usepackage{numcompress}\bibliographystyle{model6-num-names}

%% `Elsevier LaTeX' style
\bibliographystyle{elsarticle-num}

%%%%%%%%%%%%%%%%%%%%%%%
\hyphenation{}
\usepackage{eurosym}
\usepackage{threeparttable} % allow the use of footnote within tables

\usepackage{url}
\usepackage[colorlinks=true, citecolor=blue, linkcolor=blue, filecolor=blue,urlcolor=blue]{hyperref}

%to add the number to the lines
\usepackage{lineno}
\modulolinenumbers[5]

\usepackage{lineno,hyperref}
\modulolinenumbers[1]
\usepackage{amsmath}
\usepackage{siunitx}
\usepackage{eurosym}
\biboptions{numbers,sort&compress}
\usepackage[europeanresistors,americaninductors]{circuitikz}
\usepackage{adjustbox}
\usepackage{xspace}
\usepackage{caption}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{threeparttable}
\usepackage{multicol}
\usepackage{float}
\usepackage{graphicx,dblfloatfix}
\usepackage{csvsimple}
\usepackage{amsmath}
%% new commands
\newcommand{\ubar}[1]{\text{\b{$#1$}}}
\newcommand*\OK{\ding{51}}
%\renewcommand*\nompostamble{\end{multicols}}
\newcommand{\specialcell}[2][c]{%
	\begin{tabular}[#1]{@{}l@{}}#2\end{tabular}}
\newcommand{\ra}[1]{\renewcommand{\arraystretch}{#1}}	

\def\co{CO${}_2$}
\def\el{${}_{\textrm{el}}$}
\def\th{${}_{\textrm{th}}$}


%\renewcommand*{\today}{July, 10 2018}
%\hypersetup{draft} %to avoid problems with hyperref while drafting

\begin{document}

\begin{frontmatter}

\title{Supplementary Materials for ``Early decarbonisation of the European energy system pays off'' }

\author[mymainaddress,iClimate]{Marta Victoria\corref{mycorrespondingauthor}}
\ead{mvp@eng.au.dk}
\author[mymainaddress]{Kun Zhu}
\author[kitaddress]{Tom Brown}
\author[mymainaddress,iClimate]{Gorm B. Andresen}
\author[mymainaddress,iClimate]{Martin Greiner}
\cortext[mycorrespondingauthor]{Corresponding author}
\address[mymainaddress]{Department of Engineering, Aarhus University, Inge Lehmanns Gade 10, 8000 Aarhus, Denmark}
\address[iClimate]{iCLIMATE Interdisciplinary Centre for Climate Change, Aarhus University}
\address[kitaddress]{Institute for Automation and Applied Informatics (IAI), Karlsruhe Institute of Technology (KIT), Forschungszentrum 449, 76344, Eggenstein-Leopoldshafen, Germany}



%\begin{abstract}

%\end{abstract}

%\begin{keyword}

%storage, energy system modelling, sector coupling, grid integration of renewables, transmission grid, CO2 emission targets

%\texttt{elsarticle.cls}\sep \LaTeX\sep Elsevier \sep template
%\MSC[2010] 00-01\sep  99-00
%\end{keyword}

\end{frontmatter}

\section{Historical greenhouse gases emissions in the European Union}

The carbon budget from now onwards for the generation of electricity and the supply of heating in residential and services sector in Europe accounts for 21 GtCO$_2$. It has been estimated based on a global carbon budget of 800 GtCO$_2$ to avoid temperature increments above 1.75$^{\circ}$C relative to preindustrial period with a probability of greater than 66\% \cite{IPCC_1.5}. The global budget is assumed to be split among regions according to a constant per-capita ratio which translates into a 6\% share for Europe \cite{Raupach_2014}. Out of the total emissions in Europe, the ratio corresponding to electricity and heating is considered constant and equal to present values. In 2017, electricity generation and heating in the residential and services sector emitted 1.56 GtCO$_2$ which represents 43.5\% of European emissions,  \cite{UNFCCC_inventory} and Figure \ref{fig_historical_emissions} . \\
%Figueres_2017, blog_budget

\begin{figure}[!h]
\centering
\includegraphics[width=\textwidth]{figures/historical_sectoral_emissions.png}
\caption{Sectoral distribution of historical emissions in the European Union \cite{UNFCCC_inventory}. The black stars indicate committed EU reduction targets, while white stars mark under-discussion targets.} \label{fig_historical_emissions} 
\end{figure}

\FloatBarrier

\section{CO$_2$ restriction paths with equivalent budget}

The $B$=21 GtCO$_2$ budget can be utilised following different transition paths. One option consists in assuming a linear CO$_2$ restriction path. Emissions will then reach zero in $t_f$

\begin{equation}
	t_f=t_0+\frac{2B}{e_0}
\end{equation}
where $t_0$=2020, and $e_0$ represents the carbon emissions from electricity and heating sectors in 2020, which are assumed to be the same as in 2017. \\

Alternatively, emissions can be assumed to follow a path defined by one minus the cumulative distribution function (CDF$_\beta$) of a beta distribution in which $\beta_1$ = $\beta_2$. 

\begin{equation}
\begin{aligned}
&	e (t) = e_0(1- CDF_{\beta}(t)) \\
&	CDF_{\beta} (t) =\int_{-\infty}^{t} PDF_{\beta}(t) dt \\
&	PDF_{\beta} (t) =  \frac{\Gamma(\beta_1+\beta_2)}{\Gamma(\beta_1)+\Gamma(\beta_2)} t^{\beta_1-1} (1-t)^{\beta_2-1}
\end{aligned}
\end{equation}
where $\Gamma$ is the gamma function. The cumulative emissions fulfil $\int_{t_0}^{\infty} e(t) dt =B$. \\

The third option considered for the transition path is an exponential decay, following Raupach \textit{et al. }\cite{Raupach_2014}. In that case, emissions evolve as:
\begin{equation}
e(t) = e_0(1+(r+m)t)e^{-mt}
\end{equation}
where $r$ is the initial linear growth rate, which here is assumed to be $r$=0, and the decay parameter $m$ is determined by imposing the integral of the path to be equal to the budget.
\begin{equation}
\begin{aligned}
& B=\int_{t_0}^{\infty} e_0(1+(r+m)t)e^{-mt} dt \\
& m=\frac{1+ \sqrt{1+\frac{rB}{e_0}}}{\frac{B}{e_0}}
\end{aligned}
\end{equation}
Although the exponential decay path approaches asymptotically to zero, we assume here that $e(2050)=0$. By doing that, the final point of the different transition paths is equivalent and all of them achieve net-zero emissions by 2050.

\FloatBarrier

\newpage

\section{Historical evolution of CO$_2$ emissions from heating supply in residential and services sector in European countries}

\begin{figure}[!h]
\centering
\includegraphics[width=12cm]{figures/emissions_heating.png}
\caption{Historical CO$_2$ emissions from the heating in residential and services sector \cite{UNFCCC_inventory}. } \label{fig_emissions_heating} 
\end{figure}

\begin{figure}[!h]
\centering
\includegraphics[width=\textwidth]{figures/heating_historical.png}
\caption{Historical share of technologies used to supply heating demand in the residential and services sector \cite{IDEES}. } \label{fig_historical_heating} 
\end{figure}



\FloatBarrier

\newpage

\section{Historical build rates for solar photovoltaics in European countries}

\begin{figure}[!h]
\centering
\includegraphics[width=12cm]{figures/installation_rates_PV.png}
\caption{Photovoltaic annual build rates for those European countries with a prominent peak \cite{IRENA_2019}. The sharp increase and subsequent decrease in the installation rates were caused by country-specific successive changes in the regulatory frameworks. See for instance \cite{Report_Fraunhofer_2019, Victoria_2012}. } \label{fig_installation_rates_PV} 
\end{figure}
 
\FloatBarrier

\section{Model description}

In every time step, the optimisation objective, that is, the total annualised system cost is calculated as:

\begin{align}
& \min_{\substack{G_{n,s},E_{n,s},\\F_\ell,g_{n,s,t}}} \left[ \sum_{n,s} c_{n,s} \cdot G_{n,s} +\sum_{n,s} \hat{c}_{n,s} \cdot E_{n,s} \right. \nonumber \\
& \hspace{2cm} \left. + \sum_{\ell} c_{\ell} \cdot F_{\ell}+ \sum_{n,s,t} o_{n,s,t} \cdot g_{n,s,t} \right]
\label{eq_objective}
\end{align}

where $c_{n,s}$ are the fixed annualised costs for generator and storage power capacity $G_{n,s}$ of technology $s$ in every bus $n$, $\hat{c}_{n,s}$ are the fixed annualised costs for storage energy capacity $E_{n,s}$, $c_\ell$ are the fixed annualised costs for bus connectors $F_{\ell}$, and $o_{n,s,t}$ are the variable costs (which in some cases include CO$_2$ tax), for generation and storage dispatch $g_{n,s,t}$ in every hour $t$. Bus connectors $\ell$ include transmission lines but also converters between the buses implemented in every country (see Figure \ref{Fig_buses}), for instance, heat pumps that connect the electricity and heating bus. \\

The optimisation of the system is subject to several constraints. First, hourly demand $d_{n,t}$ in every bus $n$ must be supplied by generators in that bus or imported from other buses. $f_{\ell,t}$ represents the energy flow on the link $l$ and $\alpha_{n,\ell,t}$ indicates both the direction and the efficiency of flow on the bus connectors.  $\alpha_{n,\ell,t}$ can be time dependent such as in the case of heat pumps whose conversion efficiency depends on the ambient temperature.

\begin{equation}
\sum_{s} g_{n,s,t}+ \sum_{\ell} \alpha_{n,\ell,t}\cdot f_{\ell,t} = d_{n,t} \hspace{.2cm} \leftrightarrow \hspace{0.2cm} \lambda_{n,t} \hspace{.3cm} \forall\, n,t \label{eq_energy_balance}
\end{equation}

The Lagrange multiplier $\lambda_{n,t}$,  also known as Karun-Kush-Tucker (KKT),  associated with the demand constraint indicates the marginal price of the energy carrier in the bus $n$, \textit{e.g.}, local marginal electricity price in the electricity bus. \\

Second, the maximum power flowing through the links is limited by their maximum physical capacity $F_{\ell}$. For transmission links, $\ubar{f}_{\ell,t}=-1$ and $\bar{f}_{\ell,t}=1$, which allows both import and export between neighbouring countries. For a unidirectional converter \textit{e.g.}, a heat resistor, $\ubar{f}_{\ell,t}=0$ and $\bar{f}_{\ell,t}=1$ since a heat resistor can only convert electricity into heat.

\begin{equation}
\ubar{f}_{\ell,t} \cdot F_{\ell} \leq f_{\ell,t} \leq \bar{f}_{\ell,t} \cdot F_{\ell} \hspace{1cm} \forall\, \ell,t \; . \label{eq_links}
\end{equation}

For interconnecting transmission lines, the lengths $l_{\ell}$ are set by the distance between the geographical mid-points of each country, so that some of the transmission within each country is also reflected in the optimisation. A factor of 25\% is added to the line lengths to account for the fact that transmission lines cannot be placed as the crow flies due to land use restriction. For the transmission lines capacities $F_{\ell}$, a safety margin of 33\% of the installed capacity is used to satisfy n-1 requirements \cite{Brown_2016}. \\ %Linear optimal power flow is applied using Kirchhoff's formulation \cite{Horsch_2018}. 

Third, for every hour the maximum capacity that can provide a generator or storage is bounded by the product between installed capacity $G_{n,s}$ and availabilities $\ubar{g}_{n,s,t}$, $\bar{g}_{n,s,t}$. For instance, for solar generators $\ubar{g}_{n,s,t}$ is zero and $\bar{g}_{n,s,t}$ refers to the capacity factor at time $t$ 

\begin{equation}
\ubar{g}_{n,s,t} \cdot G_{n,s} \leq g_{n,s,t} \leq \bar{g}_{n,s,t} \cdot G_{n,s} \hspace{1cm} \forall\, n,s,t \; . \label{eq_g}
\end{equation}

The maximum power capacity for generators is limited by potentials $\bar{G}_{n,s}$ that are estimated taking into account physical and environmental constraints:
\begin{equation}\label{eq_max_G}
0 \leq G_{n,s}\leq \bar{G}_{n,s} \hspace{1cm} \forall\, n,s \; .
\end{equation}

The storage technologies have a charging efficiency $\eta_{in}$ and rate $g_{n,s,t}^+$, a discharging efficiency $\eta_{out}$ and rate $g_{n,s,t}^-$, possible inflow $g_{n,s,t,\textrm{inflow}}$ and spillage $g_{n,s,t,\textrm{spillage}}$, and standing loss $\eta_0$. The state of charge $e_{n,s,t}$ of every storage has to be consistent with charging and discharging in every hour and is limited by the energy capacity of the storage $E_{n,s}$. It should be remarked that the storage energy capacity $E_{n,s}$ can be optimised independently of the storage power capacity $G_{n,s}$.

\begin{align}
e_{n,s,t} = & \ \eta_0 \cdot e_{n,s,t-1} + \eta_{in} |g_{n,s,t}^+| - \eta_{out}^{-1} |g_{n,s,t}^-| \nonumber \\
& + g_{n,s,t,\textrm{inflow}} - g_{n,s,t,\textrm{spillage}} \; , \nonumber \\
& 0  \leq   e_{n,s,t} \leq E_{n,s}   \hspace{0.5cm} \forall\, n,s,t \; . \label{eq_storage}
\end{align}

So far, equations (\ref{eq_energy_balance}) to (\ref{eq_storage}) represent mainly technical constraints but additional constraints can be imposed to bound the solution.\\

The interconnecting transmission expansion can be limited by a global constraint
\begin{equation}
\sum_{\ell} l_\ell \cdot F_{\ell} \leq  \textrm{CAP}_{LV} \hspace{.7cm} \leftrightarrow \hspace{0.3cm} \mu_{LV} \; ,
%\hspace{.3cm} 
\label{eq_cap}
\end{equation}
where the sum of transmission capacities $F_{\ell}$ multiplied by the lengths $l_{\ell}$ is bounded by a transmission volume cap $\textrm{CAP}_{LV}$. In this case, the Lagrange/KKT multiplier $\mu_{LV}$ represents the shadow price of a marginal increase in transmission volume.\\


The maximum CO$_2$ allowed to be emitted by the system $\textrm{CAP}_{CO2}$ can be imposed through the constraint 

\begin{equation}
  \sum_{n,s,t}  \varepsilon_{s} \frac{ g_{n,s,t} }{\eta_{n,s}} + \sum_{n,s} \varepsilon_{s} (e_{n,s,t=0} - e_{n,s,t=T})  \leq  \textrm{CAP}_{CO2} \hspace{.4cm} \leftrightarrow \hspace{0.3cm} \mu_{CO2} \label{eq_co2cap}
\end{equation}

where $\varepsilon_{s}$ represents the specific emissions in CO$_2$-tonne-per-MWh\th{} of the fuel $s$, $\eta_{n,s}$ the efficiency and $g_{n,s,t}$ the generators dispatch. In this case, the Lagrange/KKT multiplier represents the shadow price of CO$_2$, \textit{i.e.}, the additional price that should be added for every unit of CO$_2$ to achieve the CO$_2$ reduction target in an open market. 


\begin{figure}[!t]
\centering
    %trim={<left> <lower> <right> <upper>}
  \begin{adjustbox}{scale=0.60,trim=5 6.8cm 0 0}
  \begin{circuitikz}
  \draw (1.5,14.5) to [short,i^=grid connection] (1.5,13);
  \draw [ultra thick] (-5,13) node[anchor=south]{electric bus} -- (6,13);
  \draw(2.5,13) |- +(0,0.5) to [short,i^=$$] +(2,0.5);
  \draw (0,-0.5) ;
  \draw (0.5,13) -- +(0,-0.5) node[sground]{};
  \draw (2.5,12) node[vsourcesinshape, rotate=270](V2){}
  (V2.left) -- +(0,0.6);
  \draw (2.5,11.2) node{generators};
    \node[draw,minimum width=1cm,minimum height=0.6cm,anchor=south west] at (3.4,11.9){storage};
    \draw (4,13) to (4,12.5);


  \draw [ultra thick] (-6,10) node[anchor=south]{transport} -- (-3,10);
  \draw (-5.5,10) -- +(0,-0.5) node[sground]{};
  \draw (-3.5,10) to [short,i_=${}$] (-3.5,13);
  \draw (-3.2,11.5)  node[rotate=90]{discharge};
  \draw (-4.5,13) to [short,i^=${}$] (-4.5,10);
  \draw (-4.2,11.5)  node[rotate=90]{charge};
  \node[draw,minimum width=1cm,minimum height=0.6cm,anchor=south west] at (-4.5,8.9){battery};
  \draw (-4,10) to (-4,9.5);

    \draw [ultra thick] (2,10) -- (6.5,10)  node[anchor=south]{heat};
  \draw (3.5,10) -- +(0,-0.5) node[sground]{};
  % esource (empty source) is a dipole, so remove the legs by making it connect a distance of its own width
  % follows: http://tex.stackexchange.com/questions/87275/use-circuitikz-voltage-source-icon-as-a-node
  \draw (4.5,9.35) to [esource] (4.5,8.5);
  \draw (4.5,10) -- (4.5,9.35);
  \draw (4.5,8.3) node{solar thermal};
  \draw (5,13) to [short,i^=heat pump;] (5,10);
  \draw (6.2,11) node{resistive heater};
  \node[draw,minimum width=1cm,minimum height=0.6cm,anchor=south west] at (5.5,8.9){hot water tank};
  \draw (6,10) to (6,9.5);


  \draw [ultra thick] (-2,10)  -- (0.5,10) node[anchor=south]{hydrogen};
  \draw (-1.5,13) to [short,i_=${}$] (-1.5,10);
    \draw (-1.2,11.5)  node[rotate=90]{electrolysis};
  \draw (-0.5,10) to [short,i^=${}$] (-0.5,13);
  \draw (-0.2,11.5)  node[rotate=90]{fuel cell};
  \draw (-1,10) to (-1,9.5);
  \node[draw,minimum width=1cm,minimum height=0.6cm,anchor=south west] at (-1.5,8.9){store};

  %\draw (0,10) to [short,i_=${}$] (0,8);
  \draw [ultra thick] (0.5,8) node[anchor=south]{methane} -- (3,8);
  \draw (1.5,8) to [short,i_=${}$] (1.5,13);
  \draw (2.5,8) to [short,i_=${}$] (2.5,10);
  %\node[draw,minimum width=1cm,minimum height=0.6cm,anchor=south west] at (0.5,6.9){store};
  %\draw (1,8) to (1,7.5);
  %\draw (0.3,9)  node[rotate=90]{methanation};
  \draw (1.8,9.2)  node[rotate=90]{generator/CHP};
  \draw (2.8,9)  node[rotate=90]{boiler/CHP};

  \end{circuitikz}

\end{adjustbox}
\caption{Energy flow at a single node representing a country. Within each node, there is a bus (thick horizontal line) for every sector 
(electricity, transport and heating), to which different loads (triangles), energy sources (circles), storage units (rectangles) and converters (lines connecting buses) are attached.}
\label{Fig_buses}
\end{figure}


\section{Sectors description and data}



\subsection{Electricity sector}
Hourly electricity demand for every country corresponding to 2015 is retrieved from EU Network Transmission System Operators of Electricity (ENTSO-E) via the convenient dataset prepared by the Open Power System Data (OPSD) initiative \cite{OPSD}. In every country, electricity can be generated by solar PV, onshore wind, offshore wind, Open Cycle Gas Turbines (OCGT), Combined Cycle Gas Turbines (CCGT), coal, lignite, and nuclear power plants and CHP units using either gas, coal or biomass. Their costs, lifetimes and efficiencies are shown in Table \ref{tab:cost per year}.  To represent scheduled shut-down, a constant 90\% availability is assumed for nuclear power plants. Country-wise onshore and offshore wind capacity factor time series are modelled by converting wind velocity from Climate Forecast System Reanalysis (CFSR) \cite{CFSR} into wind generation, following the methodology described in \cite{Andresen_2015}. CFSR database comprises hourly resolution and spatial resolution equal to 0.3125$^{\circ}$x0.3125$^{\circ}$, which in Europe roughly corresponds to 40x40 km$^2$. For every country, a capacity layout proportional to wind resource is assumed. Following \cite{Schlachtberger_2017}, large countries are divided into up to 4 regions sorted by wind resource. Independent classes of generators with different time series and average full load hours are added to a single node representing a country. Their optimised capacities are later aggregated on a country level for analysis. Time series representing the hourly capacity factors for solar PV were obtained by converting bias-corrected CFSR reanalysis irradiance into solar electricity generation, assuming a uniform capacity layout across every country. Details on the conversion and aggregation methodology can be found in \cite{Victoria_2019b}, the complete time series dataset is available in \href{https://doi.org/10.5281/zenodo.1321809}{10.5281/zenodo.1321809}. 50\% of PV capacity in every country is assumed to be utility-scale installations and 50\% rooftop PV systems with the cost and characteristics gathered in Tables \ref{tab:cost per year} and \ref{tab:inputs}. The discount rate is assumed to be 7\% for the former and 4\% for the latter. As discussed in \cite{Victoria_2019_EUPVSEC} the impact of this assumption is limited. The maximum capacity for onshore wind, offshore wind, and solar PV that can be installed in every country is limited by the estimated potentials. Those are determined by summing the available land in every reanalysis grid cell, which in turn is calculated by considering only the suitable land for every technology, according to the Corine Land Cover database \cite{Corine_2014} and subtracting Natura 2000 protected areas \cite{Natura2000}. For onshore and offshore wind, the potential is calculated as 20\% of the available land. For solar PV, 3\% of the available land is used for estimating the potential.
\begin{equation}
	Potential_{n, PV} =\sum_i 0.03 \cdot A^{CLC, PV}_i (1- A^{Natura 2000}_i) \hspace{0.3cm} \text{for} \hspace{0.3cm} i \in n
\end{equation}

where $A^{CLC, PV}_i$ is the area of the grid cell belonging to PV categories in the Corine Land Cover database, Table \ref{tab_Corine}, and $A^{Natura 2000}_i$ is the area of the grid cell protected by the Natura 2000 network. 

\begin{equation}
	Potential_{n, wind} = \sum_i 0.2 \cdot A^{CLC, wind}_i (1- A^{Natura 2000}_i) k_n \hspace{0.3cm} \text{for} \hspace{0.3cm}  i \in n
\end{equation}

For wind, $k_n$ is a coefficient calculated by imposing the condition that in none of the grid cells the install capacity surpasses the potential. This represents a conservative approach. Higher potentials could be attained if assumed capacity layout is not proportional to the wind resource. For offshore wind, only areas whose sea depth is lower than 50 m are considered as valid. 


\begin{table}[!b]
\footnotesize
\centering
\begin{threeparttable}
\caption{Land types considered suitable for every technology \cite{Corine_2014, Scholz_2012}.} \label{tab_Corine}
\centering
\begin{tabularx}{13cm}{lp{10cm}}
\toprule
Solar PV  & artificial surfaces (1-11), agriculture land except for those areas already occupied by agriculture with significant natural vegetation and agro-forestry areas (12-20), natural grasslands (26),
bare rocks (31), and sparsely vegetated areas (32) \\
\midrule
Onshore wind & agriculture areas (12-22), forests (23-25), scrubs and herbaceous vegetation associations (26-29), bare rocks (31), and sparsely vegetated areas (32) \\
\midrule
Offshore wind & sea and ocean (44) \\
\bottomrule
\end{tabularx}
\end{threeparttable}
\end{table}

CHP units are modelled as extraction condensing units, the feasible space representing the possible combinations of power and heat outputs is included as a constraint in the model, as detailed in \cite{Brown_2018}. Electricity can be stored in static batteries and hydrogen storage. Alkaline electrolysers are assumed since they have a lower cost \cite{DEA_2019} and higher cumulative installed capacity \cite{Staffell_2019} than PEM electrolysers. Hydrogen can be stored in overground steel tanks or underground salt caverns \cite{Staffell_2019}. For the latter, energy capacities in every country are limited to the potential estimation for onshore salt caverns within 50 km of shore to avoid environmental issues associated with brine solution disposal, see Figure 7 in \cite{Caglayan_2019}. Electricity can also be used to produce methane by combining hydrogen and direct air captured (DAC) CO$_2$ in the Sabatier reaction. Following \cite{Brown_2018}, the energy consumed in DAC is taken into account by reducing the efficiency of the Sabatier reaction to 60\%. Alternative CO$_2$ sources, such as capturing industry process emissions or biomass-related emissions, are not included. \

The transmission links between countries are assumed to be high-voltage direct current (HVDC) connections. The lengths $l_{\ell}$ are set by the distance between the geographical mid-points of each country so that some of the transmission within each country is also reflected in the optimisation. A factor of 25\% is added to the line lengths to account for the fact that transmission lines cannot be placed as the crow flies due to land use restriction. For the transmission lines capacities $F_{\ell}$, a safety margin of 33\% of the installed capacity is used to satisfy n-1 requirements \cite{Brown_2016}. For 2020 and 2030, the capacities correspond to the values assumed in the ENTSOE Ten-Year Network Development Plan (TNYDP), see Table \ref{tab_interconnections} and \cite{TYNDP2016}. The values for 2025 are interpolated assuming a liner capacity expansion between 2020 and 2030 for every link. For years from 2035 onwards, capacities are fixed at 2030 values. \


\begin{table}[!b]
\footnotesize
\centering
\begin{threeparttable}
\caption{Transmission capacities (MW) for interconnections \cite{TYNDP2016}.} \label{tab_interconnections}
\centering

\begin{tabularx}{10.5cm}{|lrr|lrr|lrr|}
\toprule
Link & 2020 & 2030 & Link & 2020 & 2030 & Link & 2020 & 2030  \\
\midrule
\input{table_TYNDP.tex}
\bottomrule
\end{tabularx}
\end{threeparttable}
\end{table}


\subsection{Heating sector}

Annual heat demands for European countries are retrieved from \cite{HRE}. They are converted into hourly heat demand based on the population-weighted \cite{NUTS3} Heating Degree Hour (HDH), that is, heating is assumed to be proportional to the difference between ambient temperature and a threshold temperature. 17$^{\circ}$C is assumed as threshold temperature. Ambient temperature is read from the same reanalysis database \cite{CFSR} used to model wind and solar PV time series. For every country, heating demand is split between low-population density areas and high-population density areas. 44.6\%  of the European population is estimated to live in the latter \cite{Brown_2018} where district heating systems can be deployed. In high-density population areas, heating can be supplied by central ground-sourced heat pumps, heat resistors and gas boilers, as well as by CPH units. All the previous technologies are assumed to be integrated into district heating networks. Furthermore, individual air-sourced heat pumps are also allowed in those areas. In low-density population areas, heating can be supplied by individual ground-sourced heat pumps, heat resistors and gas boilers. Costs, lifetimes, and efficiencies of the different technologies are included in Table \ref{tab:cost per year}. \

The Coefficient of Performance (COP) of heat-pumps depends on ambient or ground temperature to capture the lower COP in winter. COP depends on the difference between the source and the sink temperatures $\Delta T = T_{sink}-T_{source}$. For air-sourced heat pumps (ASHP), $COP= 6.81 + 0.121 \Delta T +  0.000630 \Delta T^2$, for ground-sourced heat pumps (GSHP), $COP=8.77 + 0.150 \Delta T + 0.000734 \Delta T^2$ \cite{Staffell_2012}. The sink water temperature is assumed to be $T_{sink}=55^{\circ}$C, the source temperature for air and ground is taken from the same reanalysis database used to estimate heating demand \cite{CFSR}. Thermal energy can be stored in large water pits associated with district heating systems and individual thermal energy storage (TES), \textit{i.e.}, small water tanks.  A thermal energy density of 46.8 kWh$_{th}$/m$^3$ is assumed, corresponding to a temperature difference of 40 K. The decay of thermal energy $1 - \exp(- \frac{1}{24 \tau})$ is assumed to have a time constant of $\tau$=180 days for central TES and $\tau$=3 days for individual TES. Charging and discharging efficiencies are 90\% due to pipe losses.\\

Capacities already existing for technologies supplying heat are retrieved from \cite{heating_capacities}. For the sake of simplicity, coal, oil and gas boilers capacities are assimilated to gas boilers. Besides that, existing capacities for heat resistors, ASHP, and GSHP are included in the model. For high-density population areas, the penetration of district-heating is assumed to remain fixed at 2015 values \cite{DH_penetration} and Table \ref{tab_DH_penetration}. Cooling demand is currently supplied by electricity so it is included in the electricity demand time series. It is assumed to remain constant throughout the paths. For a thorough discussion of the impact of changing cooling demand, the reader is referred to \cite{Zhu_2020}.


\begin{figure}[!h]
	\centering
	\includegraphics[width=0.9\columnwidth]{figures/demands.png}
	\caption{Electricity, rural and urban heating, and cooling demands for Europe.} \label{fig_demands} 
\end{figure}



\begin{table}[!b]
\footnotesize
\centering
\begin{threeparttable}
\caption{Current penetration of district heating in European countries \cite{DH_penetration}.} \label{tab_DH_penetration}
\centering
\begin{tabularx}{5.5cm}{lc}
\toprule
Country & District heating penetration  \\
\midrule
\input{table_DH.tex}
\bottomrule
\end{tabularx}
\end{threeparttable}
\end{table}


\subsection{Biomass}
The solid biomass can be burnt in CHP or central heating plants associated with district heating systems or in power plants to produce electricity. The model does not include biogas that could be burnt or upgraded into biomethane. A conservative approach is followed to estimate biomass potentials in every country. From the JRC-ENSPRESO database \cite{JRC_biomass, ENSPRESO}, the potential estimations for 2030 in the scenario `medium' are retrieved, but only the types of biomass which are not competing with crops are considered valid. In essence, biomass potentials include only the following items: primary agricultural residues, primary and secondary forestry energy residues including sawdust, forestry residues from landscape care, and municipal waste.

\subsection{Existing power plants and decommissioning}

For conventional technologies, \textit{i.e.} OCGT, CCGT, coal, lignite, nuclear and CHP, installed capacities in every country in 2020 and commissioning dates are retrieved from \cite{powerplantmatching}. 
A two-step method was implemented to fill commissioning date for power plants whose data was missing. First, for units larger than 50 MW, commissioning dates have been searched and manually added. Then, for smaller units, a Kernel Density Estimation (KDE) approach is used. In essence, for every technology and country, the units with available data are used to create a distribution, which is then used to assign an estimated commissioning date for those units with missing data. For solar PV, the installed capacities in 2020 and the installation dates were obtained by processing annual installed capacities statistics from \cite{IRENA_2019}. For offshore and onshore wind, capacities and age are retrieved from \cite{thewindpower}. Existing power plants are assumed to be decommissioned at their corresponding commissioning date plus lifetime (Table \ref{tab:inputs}). When a power plant has been retrofitted, we assume that its operating life is extended by half of its nominal lifetime. 
For heating capacities, 25\% of existing capacities in 2015 are assumed to be decommissioned in every time step after 2020.
\begin{figure*}[!h]
\centering
\includegraphics[width=0.9\textwidth]{figures/age_distribution_existing.png}
\caption{Age distribution of European power plants in operation \cite{powerplantmatching, IRENA_2019}.} 
\end{figure*}


%From David's: The transmission lines between countries are treated as a transport model with controllable dispatch (a coupled source and sink), constrained by energy conservation at each node. This is considered to be a justifiable approximation because many of the international connections are already controllable point-to-point high-voltage direct current (HVDC) connections, such as those undersea (like France-Britain), those over land (like the Spain-France INELFE project) or those in the planning phase (like the HVDC link planned between Germany and Belgium), while the flow on borders with only high-voltage alternating current (HVAC) connections are being increasingly controlled by phase-shifting transformers (like the German-Dutch, German-Polish and German-Czech borders). This also follows the way that interconnectors are handled in market clearing with Net Transfer Capacities (NTCs) on many borders.

\FloatBarrier

\subsection{Transport sector} \

The transport sector is included only in the final analysis of the paper. In that case, road and rail transport are considered to be electrified at a rate equal to the CO$_2$ reduction in the heating and electricity sectors relative to 2020. In this way, transport-related CO$_2$ emissions curb in parallel to the other sectors. Annual energy demands from road and rail transport for every country are retrieved from \cite{ODYSSEE}. Aviation, shipping, and pipe transport are not included in the model.  A country-specific factor (averaging 3.5) is used to account for the increased efficiency when electrifying transport. Country-specific factors are computed by comparing the current car final energy consumption per km in \cite{ODYSSEE} (averaging 0.7 kWh/km) to the 0.2 kWh/km value assumed for plug-to-wheels efficiency in EVs. The characteristic weakly profile provided by the German Federal Highway Research Institute (BASt) \cite{BASt} is used to obtain hourly time series for European countries taking into account the corresponding local times. Furthermore, a temperature dependence is included in the time series to account for heating/cooling demand in transport. For temperatures below/above 15$^{\circ}$C/20$^{\circ}$C, temperature coefficients of 0.63\%/$^{\circ}$C and 0.98\%/$^{\circ}$C are assumed, see \cite{Brown_2018} for more details. When fully electrified, the annual electricity demand from transport sector in Europe accounts for 1,102 TWh/a. 

At every time step, the internal-combustion vehicles transformed into battery electric vehicles (BEV) are assumed to include a battery with a storage capacity of 50 kWh, charging capacity of 11 kW, and 90\% charging efficiency. It is considered that all of them can shift their charging time as well as discharge into the grid to facilitate the operation of the system and reduce its total cost. Furthermore, it is assumed that, at every time step, 25\% of the existing BEV can provide vehicle-to-grid (v2g) services. The BEV state of charge is forced to be higher than 75\% at 5 a.m. every day (through $e_{n,s,t}$ in equation \ref{eq_storage}) to ensure that the batteries are full in the morning peak usage. This also restricts BEV demand to be shifted within a day and prevent EV batteries from becoming seasonal storage. The percentage of BEV connected to the grid at any time is inversely proportional to the transport demand profile, which translates into an average/minimum availability of 80\%/62\%. This approach is conservative compared to most of the literature. For instance, in \cite{circular_economy} the average parking time of the European fleet of vehicles is estimated at 92\%. The cost of the EV batteries is not included in the model since it is assumed that EV owners buy them to satisfy their mobility needs. 


\subsection{Levelised Cost of Energy (LCOE)}

The Levelised Cost of Energy is defined as the total system cost per unit of consumed energy, that is, including supplied electricity and heating demand. \\

\section{Cost assumptions}	

\begin{table*}[!b]
\footnotesize
\centering
\begin{threeparttable}
\caption{Overnight investment cost assumptions per technology and year. All costs are given in real 2015 money. } \label{tab:cost per year}
\centering
\begin{tabularx}{18cm}{lccccccccr}
\toprule
Technology\tnote{1}& Unit & 2020&2025&2030&2035&2040&2045&2050&source\\
\midrule
\input{table_costs.tex}
\bottomrule
\end{tabularx}
\end{threeparttable}
\end{table*}

\begin{table*}
\footnotesize
\centering
\begin{threeparttable}
\caption{Efficiency, lifetime and FOM cost per technology (values shown corresponds to 2020).} \label{tab:inputs}
\centering
\begin{tabularx}{0.8\textwidth}{lrrrr}
\toprule
Technology & FOM\tnote{a} & Lifetime & Efficiency & Source\\
 & [\%/a] & [a] &  & \\
\midrule
\input{table_inputs.tex}

%Wind onshore &3 & 25  & 1 &  \cite{} \\
%Wind offshore  &2506   &kW\el  &3& 25 & 1 &  \cite{schroeder2013} \\
%Solar PV rooftop           &725   &kW\el &2 & 25  & 1 &  \cite{etip} \\
%Solar PV utility           &425   &kW\el &3 & 25  & 1 &  \cite{etip} \\
%Open cycle gas turbine (OCGT)             &400    &kW\el  &4& 30 & 0.39 &  \cite{schroeder2013,dea2016} \\
%Pumped hydro storage\tnote{b} & 2000 &kW\el & 1 & 80 & $0.87\cdot 0.87$ & \cite{schroeder2013} \\
%Hydro reservoir\tnote{b} & 2000 &kW\el & 1 & 80 & 0.9 & \cite{schroeder2013} \\
%Run-of-river\tnote{b} & 3000 &kW\el & 2 & 80 & 0.9 & \cite{schroeder2013} \\
%Battery inverter         &310   &kW\el  & 3 & 20 & $0.9\cdot0.9$ &  \cite{budischak2013} \\
%Battery storage & 144.6 & kWh & 0 & 15 & 1 & \cite{budischak2013} \\
%Hydrogen electrolysis        &350   &kW\el  & 4 & 18 & 0.8 & \cite{PalzerThesis} \\
%Hydrogen fuel cell\tnote{c} & 339 & kW\el & 3 & 20 & 0.58 & \cite{NRELhydrogen,budischak2013} \\
%Hydrogen storage\tnote{d}        & 8.4  &kWh  & 0 &20 & 1 & \cite{budischak2013} \\
%Methanation\tnote{e} & 750 & kW$_{H_2}$ & 2.5 & 25 & 0.8 & \cite{PalzerThesis}\\
%\co{} direct air capture (DAC)\tnote{e} & 228 &  t\co/a & 4 & 30 & see text & \cite{Fasihi2017}\\
%Methanation+DAC\tnote{e} & 1000 & kW$_{H_2}$ & 3 & 25 & 0.6 & \cite{PalzerThesis,Fasihi2017}\\
%Air-sourced heat pump decentral & 1050 & kW\th  & 3.5& 20 & variable & \cite{Henning20141003,PalzerThesis} \\
%Air-sourced heat pump central & 700 & kW\th  & 3.5& 20 & variable & \cite{PalzerThesis} \\
%Ground-sourced heat pump decentral & 1400 & kW\th & 3.5 &20& variable & \cite{PalzerThesis}\\
%Resistive heater & 100 & kW\th & 2 & 20 & 0.9  & \cite{SchaberThesis} \\
%Gas condensing boiler decentral & 175 & kW\th & 2 & 20 & 0.9& \cite{PalzerThesis} \\
%Gas condensing boiler central & 63 & kW\th & 1 & 22 & 0.9& \cite{PalzerThesis} \\
%Combined heat and power (CHP) central &600& kW\th & 3 & 25 & see text & \cite{Henning20141003} \\
%Solar thermal collector decentral & 270 & m$^{2}$ & 1.3 & 20 & variable & \cite{Henning20141003} \\
%Solar thermal collector central & 140 & m$^{2}$ & 1.4 & 20 & variable & \cite{Henning20141003} \\
%Hot water tank decentral & 860 & m${}^3$  & 1& 20 & $\tau = $ 3 days & \cite{IEESWV,Henning20141003} \\
%Hot water tank central & 30 & m${}^3$  & 1& 40 & $\tau = $ 180 days & \cite{IEESWV,Henning20141003} \\
%Hot water tank (dis)charging & 0 &   & & & $0.9\cdot 0.9$ & \cite{Henning20141003} \\
%High-density district heating network\tnote{f} & 220 & kW\th  & 1 & 40  & 1 & \cite{IEESWV} \\
%Gas distribution network\tnote{f} & 387 & kW\th & 2 & 40 & 1 & based on \cite{bnetza2017} \\
%Building retrofitting\tnote{f} & see text &  & 1 & 50 & 1 & \cite{Henning20141003,PalzerThesis} \\
%HVDC transmission line       &400    &MWkm & 2 & 40 & 1 & \cite{Hagspiel} \\
%HVDC converter pair & 150 & kW & 2 & 40 & 1 &  \cite{Hagspiel} \\
\bottomrule
\end{tabularx}

\begin{tablenotes}
\item [a] Fixed Operation and Maintenance (FOM) costs are given as a percentage of the overnight cost per year.
\item [b] Hydroelectric facilities are not expanded in this model and are considered to be fully amortized.
\item [c] Efficiency for Combined Heat and Power (CHP) plants depends on the electricity/heat output and it is modelled as described in the text. 
\item [d] Coefficient of performance (COP) of heat pumps is modelled as a function of temperature, as described in the text. 
%\item [c] The fuel cell technology is solid oxide, with partial (30\%) replacement after 10 years, following \cite{NRELhydrogen}. The more conservative estimate of efficiency has been taken, in line with other sources \cite{dea2016}.
%SOFC: exchange*overnight*(1+30%-replacement-10-years-out) = 0.7532*390*(1+0.3/(1.07)**10) = 338.55 \cite{NRELhydrogen}
\item [e] Investments in methanation and DAC are not allowed independently, only together as `Methanation+DAC', see text.
\item [f] District heating and gas distribution networks are not included in the optimisation, but the cost of expanding those networks is estimated and compared with the system costs in the scenarios with and without district heating expansion.  
\end{tablenotes}
\end{threeparttable}
\end{table*}

\begin{table*}
\centering
\begin{threeparttable}
\caption{Costs and emissions coefficient of fuels.} \label{tab:costs}
\centering
\begin{tabularx}{0.6\textwidth}{lrrrl}
\toprule
Fuel & Cost  & Source & Emissions & Source \\
 & [\EUR/MWh$_{th}$] & & [tCO$_2$/MWh$_{th}$] &  \\
\midrule
\input{table_fuels.tex}

\bottomrule
\end{tabularx}

\begin{tablenotes}

\item [a] Raw biomass fuel cost is assumed as the middle value of the range provided in the references for different European countries and types of sustainable biomass. 
% range in Zappa_2019: 1.4 € GJ−1 to 14.4 € GJ−1

\end{tablenotes}
\end{threeparttable}
\end{table*}


\begin{figure}[!h]
\centering
\includegraphics[width=12cm]{figures/cost_evolution.png}
\caption{Evolution of costs, relative to 2020, for some selected technologies. } \label{fig_cost_evolution} 
\end{figure}
 

\FloatBarrier

\section{Realistic cost assumptions for solar PV} 

The technology is forecast to keep decreasing its price achieving a cost between 151 \EUR/kW \cite{Vartiainen_2019} and 241 \cite{DEA_2019} \EUR/kW for utility-scale installations in 2050. The recent evolution of solar PV and the attained cost reduction is known to have been repeatedly underestimated by the International Energy Agency \cite{Fell_2015}, ecologist organisations \cite{Creutzig_2017}, and PV scientists \cite{Haegel_2019}.  Investment cost for utility-scale solar PV in 2020 is estimated in the range of 398-423 \EUR/kW \cite{Vartiainen_2017, DEA_2019}. For rooftop PV intallations, a wider range is found, 1070-1127 \EUR/kW \cite{DEA_2019, Fraunhofer, Vartiainen_2019}, due to the higher impact of local experience and labour costs. \\


Assuming outdated costs for solar PV is also known to be a flaw of most Integrated Assessment Models (IAMs) and this can have a huge impact on the results. Creutzig \textit{et al.} already pointed out this problem in \cite{Creutzig_2017} where they found similar solar PV penetration than we do when realistic costs are assumed for solar PV. However, the problem persists. For instance, the PRIMES model used in the report supporting the \textit{Clean Planet for All} strategy of the EU Commission \cite{in-depth_2018} assumes 407-495 \EUR/kW in 2050 \cite{in-depth-data} which is higher than the lower range value for today's costs. Even more worrying are the findings by Krey \textsl{et al.} \cite{Krey_2019}. The authors review the techno-economic assumptions in the electricity sector among fifteen different global and national IAMs. Figure 4 on \cite{Krey_2019} shows that most of the reviewed IAMs include cost assumptions for solar PV in 2050 close to 1000 \EUR/kW. Although they do not specify if the cost refers to utility-scale or rooftop installations, the values are twice as high as the cost already achieved by this technology in large installations. 

\section{Transition paths Gentle and Sudden. Additional results}

\begin{figure}[!h]
	\centering
	\includegraphics[width=\columnwidth]{figures/installed_capacity_Base.png}
	\caption{Installed capacities for different technologies throughout transition paths shown in Fig. 1 in the main text.} \label{fig_installed_capacity} 
\end{figure}

\begin{figure}[!h]
\centering
\includegraphics[width=\columnwidth]{figures/build_rates_Base.png}
\caption{Annual build rates for different technologies throughout transition paths shown in Fig. 1 in the main text. } \label{fig_build_rates} 
\end{figure}

\begin{figure*}[!h]
\centering
\includegraphics[width=0.8\columnwidth]{figures/storage_expansion_Base.png}
\caption{Annual build rates for batteries and hydrogen storage throughout transition paths shown in Fig. 1 in the main text.} \label{fig_battery_hydrogen} 
\end{figure*}

\begin{figure}[!h]
\centering
%\includegraphics[width=\columnwidth]{figures/spatial_plot_primary_energy.png}
\caption{Primary energy in every country in 2050. \textcolor[rgb]{1,0,0}{TODO: Add spatial plot.} } \label{fig_spatial_plot} 
%(left) Cautious transition path, (right) Greenfield optimisation for 2050.
\end{figure}


\begin{figure}[!h]
\centering
\includegraphics[width=0.8\columnwidth]{figures/utilisation_factors_Base.png}
\caption{Utilisation factors for lignite, coal, gas, and nuclear power plants throughout transition paths shown in Fig. 1 in the main text} \label{fig_utilisation_factors} 
\end{figure}

\begin{figure*}[!h]
\centering
\includegraphics[width=0.8\columnwidth]{figures/electricity_production_Base_go_oldversion.png}
\caption{Evolution of the electricity generation mix in every country for the Gentle transition path.} \label{fig_primary_energy} 
\end{figure*}



\begin{figure}[!h]
\centering
\includegraphics[width=0.8\columnwidth]{figures/heat_production_w_TYNDP_go_oldversion.png}
\caption{Evolution of technologies used to supply heating in residential and services sector in the Gentle path. } \label{fig_heating_shares} 
\end{figure}

\FloatBarrier

\section{Transition paths including district heating expansion}

In this scenario, the model is rerun assuming that district heating penetration in every country expands from its value in 2025, Table \ref{tab_DH_penetration}, to 100\%, so that in 2050 the entire urban heat demand is supplied by district heating systems.
For the Gentle path cumulative system cost reduces by 13 B\EUR. The additional cost of extending and maintaining the required district heating network can be estimated by considering a capital cost of 220\EUR/KW$_{th}$ and 40 years lifetime \cite{Brown_2018, Gerhardt_2015}. Considering that the peak in urban heat demand is approximately 500GW$_{th}$, this represents 9 B\EUR/year. However, expanding gas distribution networks also implies a cost, estimated in 387\EUR/kW$_{th}$ and 40 years lifetime \cite{Brown_2018, gas_distribution}. Consequently, the avoided expansion of gas distribution networks when district heating is deployed, makes this option clearly cheaper. 

\section{Transition paths including electricity transmission grid expansion}

In this scenario, the model is rerun assuming that from 2035 onwards transmission capacities are optimised together with the rest of the system components using 2030 values as the lower boundary. Allowing the expansion of transmission capacities results in a decrease of 84 B\EUR in the cumulative cost for the Gentle path. The reinforced interconnections contribute to the spatial smoothing of wind fluctuations, increasing the optimal onshore and offshore wind capacities at the end of the path. The required energy capacity for hydrogen storage is reduced due to interconnections contribution to balancing wind generation. 

\FloatBarrier

\section{Transition paths including transport}

\textcolor[rgb]{1,0,0}{TODO: Add results.}

\section{References}
\bibliography{bib_transition}

\end{document}